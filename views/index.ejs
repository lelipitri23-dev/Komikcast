<!DOCTYPE html>
<html lang="id">

<head>
  <%
  // --- KONFIGURASI SEO HOMEPAGE ---
  const siteUrl = "https://komikcast.help";
  const siteTitle = "Komikcast - Tempatnya Baca Komik Gratis Online Bahasa Indonesia";
  const siteDescription = "Baca ribuan komik, manga, manhwa & manhua Sub Indo gratis. Nikmati gambar terbaik & terjemahan akurat. Chapter terbaru update setiap hari!";
  
  // Gambar default untuk share home
  const defaultImage = "https://via.placeholder.com/1200x630/1e293b/ffffff?text=Komikcast+Cover";
  const siteImage = (mangas && mangas.length > 0 && mangas[0].coverImage) ? mangas[0].coverImage : defaultImage;
  %>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title><%= siteTitle %></title>
  <meta name="description" content="<%= siteDescription %>" />
  <link rel="canonical" href="<%= siteUrl %>" />
  <meta name="robots" content="index, follow" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="<%= siteUrl %>" />
  <meta property="og:title" content="<%= siteTitle %>" />
  <meta property="og:description" content="<%= siteDescription %>" />
  <meta property="og:image" content="<%= siteImage %>" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="id_ID" />
  <meta property="og:site_name" content="Komikcast" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="<%= siteUrl %>" />
  <meta name="twitter:title" content="<%= siteTitle %>" />
  <meta name="twitter:description" content="<%= siteDescription %>" />
  <meta name="twitter:image" content="<%= siteImage %>" />

  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #141414; color: #cbd5e1; }
    
    /* Scrollbar Kustom */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    /* Genre List Style */
    .genre-list li { border-bottom: 1px solid #333; padding: 5px 0; font-size: 12px; }
    .genre-list li:last-child { border-bottom: none; }
    .genre-list li a { color: #999; transition: 0.3s; display: block; }
    .genre-list li a:hover { color: #3b82f6; padding-left: 5px; }

    /* Styles untuk gambar error */
    .img-error-placeholder {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      display: flex; align-items: center; justify-content: center;
    }
    .img-error-text { color: #94a3b8; font-size: 10px; text-align: center; padding: 8px; }
    .img-error-icon { color: #475569; font-size: 24px; margin-bottom: 8px; }
  </style>

  <script>
    // Fungsi untuk menangani error gambar (Rilisan Terbaru)
    function handleImageError(img) {
      const container = img.parentElement;
      const title = img.alt || 'Cover komik';
      img.onerror = null; 
      img.style.display = 'none';
      
      const placeholderHTML = `
        <div class="img-error-placeholder absolute inset-0 flex flex-col items-center justify-center p-2">
          <div class="img-error-icon"><i class="fas fa-image"></i></div>
          <div class="img-error-text">
            <p class="font-bold text-xs mb-1">Cover N/A</p>
            <p class="text-[10px] opacity-75 truncate max-w-[90%]">${title}</p>
          </div>
        </div>
      `;
      
      const existingPlaceholder = container.querySelector('.img-error-placeholder');
      if (existingPlaceholder) {
        existingPlaceholder.innerHTML = placeholderHTML;
      } else {
        container.insertAdjacentHTML('beforeend', placeholderHTML);
      }
      container.classList.add('relative');
    }

    // Fungsi untuk menangani gambar di "Hot Comic Update"
    function handleHotImageError(img) {
      img.onerror = null;
      const container = img.parentElement;
      container.style.background = 'linear-gradient(135deg, #1e293b 0%, #0f172a 100%)';
      img.style.display = 'none';
      
      const placeholder = document.createElement('div');
      placeholder.className = 'absolute inset-0 flex flex-col items-center justify-center p-3 text-center';
      placeholder.innerHTML = `
        <i class="fas fa-image text-gray-600 text-xl mb-2"></i>
        <p class="text-gray-500 text-xs font-bold truncate w-full px-2">${img.alt}</p>
        <p class="text-gray-600 text-[10px] mt-1">Cover N/A</p>
      `;
      container.appendChild(placeholder);
    }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Daftar Komik Terbaru Komikcast",
    "description": "Koleksi manga, manhwa, dan manhua terbaru bahasa Indonesia.",
    "url": "<%= siteUrl %>",
    "itemListElement": [
      <% mangas.slice(0, 10).forEach((manga, index) => { %>
      {
        "@type": "ListItem",
        "position": <%= index + 1 %>,
        "url": "<%= siteUrl %>/komik/<%= manga.slug %>",
        "name": "<%= manga.title %>",
        "image": "<%= manga.coverImage || defaultImage %>"
      }<%= index < 9 ? ',' : '' %> 
      <% }) %>
    ]
  }
  </script>
</head>

<body>

  <%- include('partials/navbar') %>

  <div class="container mx-auto px-4 py-6">

    <div class="mb-10">
      <div class="flex items-center gap-2 mb-4 border-b border-[#333] pb-2">
        <i class="fas fa-fire text-red-500"></i>
        <h2 class="text-lg font-bold text-white uppercase italic">Hot Comic Update</h2>
      </div>

      <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
        <% mangas.slice(0, 6).forEach(manga => { 
             const coverImage = manga.coverImage || '';
        %>
          <a href="/komik/<%= manga.slug %>" class="group relative block overflow-hidden rounded-md shadow-lg aspect-[3/4] bg-[#1e293b]">
            <% if (coverImage) { %>
              <img src="<%= coverImage %>" alt="<%= manga.title %>" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500 ease-in-out" onerror="handleHotImageError(this)" loading="lazy">
            <% } else { %>
              <div class="absolute inset-0 flex flex-col items-center justify-center p-3 text-center">
                <i class="fas fa-image text-gray-600 text-xl mb-2"></i>
                <p class="text-gray-500 text-xs font-bold truncate w-full"><%= manga.title %></p>
                <p class="text-gray-600 text-[10px] mt-1">N/A</p>
              </div>
            <% } %>
            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-90"></div>
            <div class="absolute top-2 left-2 bg-yellow-500 text-black text-[10px] font-bold px-1.5 py-0.5 rounded flex items-center gap-1 shadow">
              <i class="fas fa-star text-[9px]"></i> <%= manga.rating %>
            </div>
            <div class="absolute bottom-0 p-2 w-full">
              <h3 class="text-xs font-bold text-white truncate group-hover:text-blue-400 transition" title="<%= manga.title %>">
                <%= manga.title %>
              </h3>
            </div>
          </a>
        <% }) %>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">

      <div class="lg:w-3/4">
        <div class="flex justify-between items-center border-b border-[#333] pb-3 mb-5">
          <div class="flex items-center gap-2">
            <span class="bg-blue-600 w-1 h-6 rounded-sm"></span>
            <h2 class="text-xl font-bold text-white uppercase tracking-wide">Rilisan Terbaru</h2>
          </div>
          <a href="/daftar-komik" class="text-xs font-bold bg-[#333] hover:bg-blue-600 px-3 py-1 rounded text-white transition">LIHAT SEMUA</a>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <% mangas.forEach(manga => { 
               const coverImage = manga.coverImage || '';
          %>
            <div class="bg-[#1e1e1e] rounded-lg overflow-hidden shadow-lg border border-[#2a2a2a] group hover:border-blue-500/50 transition duration-300">
              <div class="relative aspect-[15/21] overflow-hidden bg-[#1e293b]">
                <a href="/komik/<%= manga.slug %>">
                  <% if (coverImage) { %>
                    <img src="<%= coverImage %>" alt="<%= manga.title %>" class="w-full h-full object-cover group-hover:opacity-80 transition" loading="lazy" onerror="handleImageError(this)">
                  <% } else { %>
                    <div class="img-error-placeholder w-full h-full flex flex-col items-center justify-center p-3">
                      <div class="img-error-icon"><i class="fas fa-image"></i></div>
                      <div class="img-error-text">
                        <p class="font-bold text-xs mb-1">N/A</p>
                        <p class="text-[10px] opacity-75 truncate"><%= manga.title %></p>
                      </div>
                    </div>
                  <% } %>
                </a>
                
                <span class="absolute top-2 right-2 text-[10px] font-bold px-2 py-0.5 rounded shadow-md uppercase tracking-wider
                  <%= manga.type && manga.type.toLowerCase().includes('manhwa') ? 'bg-purple-600 text-white' : (manga.type && manga.type.toLowerCase().includes('manhua') ? 'bg-red-600 text-white' : 'bg-gray-200 text-black') %>">
                  <%= manga.type || 'Manga' %>
                </span>
                
                <% if (manga.rating && manga.rating >= 8) { %>
                  <span class="absolute top-2 left-2 bg-red-600 text-white text-[9px] font-bold px-1.5 rounded uppercase">HOT</span>
                <% } %>
              </div>

              <div class="p-3">
                <a href="/komik/<%= manga.slug %>">
                  <h3 class="font-bold text-[13px] text-white leading-snug truncate hover:text-blue-500 transition mb-3" title="<%= manga.title %>">
                    <%= manga.title %>
                  </h3>
                </a>
                <div class="space-y-1.5">
                  <% if (manga.chapters && manga.chapters.length > 0) { %>
                    <% manga.chapters.slice(0, 3).forEach(chap => { %>
                      <div class="flex justify-between items-center text-[10px] border-t border-[#333] pt-1.5">
                        <% 
                           let chapterSlug = '';
                           if (chap.url) {
                              const parts = chap.url.split('/').filter(p => p.length > 0);
                              chapterSlug = parts[parts.length - 1];
                           }
                        %>
                        <a href="/baca/<%= manga.slug %>/<%= chapterSlug %>" class="bg-[#2a2a2a] hover:bg-blue-600 text-gray-300 hover:text-white px-2 py-0.5 rounded-[3px] transition truncate max-w-[65%]">
                          <%= chap.title %>
                        </a>
                        <span class="text-gray-500 italic text-[9px]">
                          <%= chap.releaseDate %>
                        </span>
                      </div>
                    <% }) %>
                  <% } else { %>
                    <div class="text-[10px] text-gray-600 italic text-center py-2">Belum ada chapter</div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      </div>

      <div class="lg:w-1/4 space-y-8" id="sidebar">

        <div class="bg-[#1e1e1e] rounded-lg border border-[#333] overflow-hidden">
          <div class="bg-[#252525] p-3 border-b border-[#333]">
            <h3 class="text-sm font-bold text-white uppercase border-l-4 border-blue-500 pl-2">Chat</h3>
          </div>
          <div class="p-3">
            <script id="cid0020000335779072310_" data-cfasync="false" async="" src="//st.chatango.com/js/gz/emb.js" style="width: 100%;height: 450px;">{"handle":"komikcastsite","arch":"js","styles":{"a":"0084ef","b":100,"c":"FFFFFF","d":"FFFFFF","k":"0084ef","l":"0084ef","m":"0084ef","n":"FFFFFF","p":"10","q":"0084ef","r":100,"usricon":0.85,"cnrs":"0.35","fwtickm":1}}</script>
          </div>
        </div>

        <div class="bg-[#1e1e1e] rounded-lg border border-[#333] overflow-hidden">
          <div class="bg-[#252525] p-3 border-b border-[#333]">
            <h3 class="text-sm font-bold text-white uppercase border-l-4 border-blue-500 pl-2">Genre</h3>
          </div>
          <div class="p-4">
            <ul class="genre-list grid grid-cols-2 gap-x-4">
              <% 
                const genreList = ['4-Koma', 'Action', 'Adventure', 'Comedy', 'Cooking', 'Demons', 'Drama', 'Ecchi', 'Fantasy', 'Game', 'Gender Bender', 'Gore', 'Harem', 'Historical', 'Horror', 'Isekai', 'Josei', 'Magic', 'Martial Arts', 'Mature', 'Mecha', 'Medical', 'Military', 'Music', 'Mystery', 'One-Shot', 'Police', 'Psychological', 'Reincarnation', 'Romance', 'School', 'School Life', 'Sci-Fi', 'Seinen', 'Shoujo', 'Shoujo Ai', 'Shounen', 'Shounen Ai', 'Slice of Life', 'Sports', 'Super Power', 'Supernatural', 'Thriller', 'Tragedy', 'Vampire', 'Webtoons', 'Yuri'];
                genreList.forEach(genre => { 
              %>
                <li>
                  <a href="/genres/<%= genre.toLowerCase().replace(/ /g, '-') %>" title="View all series in genre <%= genre %>">
                    <%= genre %>
                  </a>
                </li>
              <% }) %>
            </ul>
          </div>
        </div>

        <div class="bg-[#1e1e1e] rounded-lg border border-[#333] overflow-hidden">
          <div class="bg-[#252525] p-3 border-b border-[#333]">
            <h3 class="text-sm font-bold text-white uppercase border-l-4 border-blue-500 pl-2">Join Our Discord Server!</h3>
          </div>
          <div class="p-3 text-center">
            <a href="https://discord.gg/n8XEka8" target="_blank" rel="noopener">
              <img decoding="async" src="https://komikcast03.com/wp-content/uploads/2017/10/adasa.png" class="w-full rounded-lg hover:opacity-90 transition" alt="Discord Komikcast" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/1e293b/ffffff?text=Discord+Komikcast';">
            </a>
          </div>
        </div>

        <div class="bg-[#1e1e1e] rounded-lg border border-[#333] overflow-hidden">
          <div class="bg-[#252525] p-3 border-b border-[#333]">
            <h3 class="text-sm font-bold text-white uppercase border-l-4 border-blue-500 pl-2">Popular Manga</h3>
          </div>
          <div class="p-3">
            <ul class="space-y-4">
              <% mangas.sort((a, b) => (b.rating || 0) - (a.rating || 0)).slice(0, 10).forEach((m, idx)=> {
                const coverImage = m.coverImage || '';
              %>
              <li class="flex gap-3 items-start group cursor-pointer border-b border-[#333] pb-3 last:border-0">
                <div class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#2a2a2a] text-blue-500 font-bold text-lg rounded">
                  <%= idx+1 %>
                </div>

                <div class="w-14 h-20 flex-shrink-0 overflow-hidden rounded relative bg-[#1e293b]">
                  <% if (coverImage) { %>
                    <img 
                      src="<%= coverImage %>" 
                      class="w-full h-full object-cover" 
                      alt="<%= m.title %>"
                      onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center text-gray-500\'><i class=\'fas fa-image text-lg\'></i></div>';"
                      loading="lazy"
                    >
                  <% } else { %>
                    <div class="w-full h-full flex items-center justify-center text-gray-500">
                      <i class="fas fa-image text-lg"></i>
                    </div>
                  <% } %>
                </div>

                <div class="flex flex-col flex-1 min-w-0">
                  <a href="/komik/<%= m.slug %>" class="text-xs font-bold text-gray-200 group-hover:text-blue-500 truncate transition mb-1 block" title="<%= m.title %>">
                    <%= m.title %>
                  </a>
                  <div class="text-[10px] text-gray-500 leading-tight truncate">
                    <span class="font-bold text-gray-400">Genres:</span>
                    <% if (m.genres && m.genres.length > 0) { %>
                      <%= m.genres.slice(0, 3).join(', ') %>
                    <% } else { %> - <% } %>
                  </div>
                  <span class="text-[10px] text-gray-600 mt-1">
                    <%= m.lastUpdated ? new Date(m.lastUpdated).getFullYear() : 'N/A' %>
                  </span>
                </div>
              </li>
              <% }) %>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>

  <%- include('partials/footer') %>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const allImages = document.querySelectorAll('img');
      allImages.forEach(img => {
        if (!img.hasAttribute('onerror')) {
          img.addEventListener('error', function() {
            if (!this.classList.contains('error-handled')) {
              this.classList.add('error-handled');
              handleImageError(this);
            }
          });
        }
      });
    });
  </script>

</body>
</html>
